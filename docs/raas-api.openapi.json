{
  "openapi": "3.0.3",
  "info": {
    "title": "RAAS Dashboard API",
    "description": "RAAS 产品管理与进度追踪的 API 接口文档。\n\n## 概述\n该 API 用于支持 RAAS Dashboard 前端的以下功能：\n- 产品管理（增删改查）\n- 进度追踪数据查询\n- 手动触发数据更新任务\n- 获取数据最后更新时间\n- Keepa 数据获取",
    "version": "1.0.0",
    "contact": {
      "name": "RAAS Team",
      "email": "support@raas.example.com"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost:8881/api",
      "description": "本地开发服务器"
    }
  ],
  "tags": [
    {
      "name": "Products",
      "description": "产品管理相关接口"
    },
    {
      "name": "Product Progress",
      "description": "产品进度追踪（合并产品信息和进度数据）"
    },
    {
      "name": "Data Update",
      "description": "数据更新相关接口"
    }
  ],
  "paths": {
    "/products": {
      "get": {
        "tags": ["Products"],
        "summary": "获取产品列表",
        "description": "根据筛选条件获取 RAAS 产品列表，支持分页",
        "parameters": [
          { "$ref": "#/components/parameters/PageParam" },
          { "$ref": "#/components/parameters/PageSizeParam" },
          {
            "name": "amazon_profile_name",
            "in": "query",
            "description": "Amazon Profile 名称筛选（支持多选，后端使用 IN 查询）",
            "style": "form",
            "explode": true,
            "schema": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          {
            "name": "hanna_org_name",
            "in": "query",
            "description": "Hanna Org 名称筛选（支持多选，后端使用 IN 查询）",
            "style": "form",
            "explode": true,
            "schema": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          {
            "name": "raas_plan",
            "in": "query",
            "description": "RAAS 计划筛选",
            "schema": { "type": "string" }
          },
          {
            "name": "category_name",
            "in": "query",
            "description": "类目名称筛选（支持多选，后端使用 IN 查询）",
            "style": "form",
            "explode": true,
            "schema": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "状态筛选（支持多选，后端使用 IN 查询）",
            "style": "form",
            "explode": true,
            "schema": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["ONGOING", "SUCCESS", "CANCELLED"]
              }
            }
          },
          {
            "name": "marketplace",
            "in": "query",
            "description": "市场筛选",
            "schema": { "type": "string", "default": "US" }
          },
          {
            "name": "ad_window",
            "in": "query",
            "description": "广告数据窗口（仅影响广告指标计算，不触发表格重新加载）",
            "schema": {
              "type": "string",
              "enum": ["7d", "14d", "30d", "rt"]
            }
          },
          {
            "name": "start_date_from",
            "in": "query",
            "description": "开始日期筛选（从）",
            "schema": { "type": "string", "format": "date" }
          },
          {
            "name": "start_date_to",
            "in": "query",
            "description": "开始日期筛选（至）",
            "schema": { "type": "string", "format": "date" }
          },
          {
            "name": "end_date_from",
            "in": "query",
            "description": "结束日期筛选（从）",
            "schema": { "type": "string", "format": "date" }
          },
          {
            "name": "end_date_to",
            "in": "query",
            "description": "结束日期筛选（至）",
            "schema": { "type": "string", "format": "date" }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取产品列表",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ProductListResponse" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      },
      "post": {
        "tags": ["Products"],
        "summary": "创建新产品",
        "description": "创建一个新的 RAAS 产品记录",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ProductCreate" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "产品创建成功",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Product" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      },
      "put": {
        "tags": ["Products"],
        "summary": "更新产品",
        "description": "更新现有产品记录",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ProductUpdate" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "产品更新成功",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Product" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    },
    "/product-progress": {
      "get": {
        "tags": ["Product Progress"],
        "summary": "获取产品进度列表（合并产品信息和进度数据）",
        "description": "获取 RAAS 产品的进度追踪数据，包含产品基础信息和进度数据。\n\n## 数据来源\n该接口从 Lakehouse 定时调度更新的结果表中获取数据，\n合并了产品基础信息和进度追踪数据。\n\n## 使用场景\n- 表格页面初始加载\n- 分页、筛选条件变化时刷新数据\n\n## 注意\n不传入 ad_window 参数，一次性返回所有7d/14d/30d/rt的广告数据",
        "parameters": [
          { "$ref": "#/components/parameters/PageParam" },
          { "$ref": "#/components/parameters/PageSizeParam" },
          {
            "name": "amazon_profile_name",
            "in": "query",
            "description": "Amazon Profile 名称筛选（支持多选，后端使用 IN 查询）",
            "style": "form",
            "explode": true,
            "schema": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          {
            "name": "hanna_org_name",
            "in": "query",
            "description": "Hanna Org 名称筛选（支持多选，后端使用 IN 查询）",
            "style": "form",
            "explode": true,
            "schema": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          {
            "name": "raas_plan",
            "in": "query",
            "description": "RAAS 计划筛选",
            "schema": { "type": "string" }
          },
          {
            "name": "category_name",
            "in": "query",
            "description": "类目名称筛选（支持多选，后端使用 IN 查询）",
            "style": "form",
            "explode": true,
            "schema": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "状态筛选（支持多选，后端使用 IN 查询）",
            "style": "form",
            "explode": true,
            "schema": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["ONGOING", "SUCCESS", "CANCELLED"]
              }
            }
          },
          {
            "name": "marketplace",
            "in": "query",
            "description": "市场筛选",
            "schema": { "type": "string", "default": "US" }
          },
          {
            "name": "start_date_from",
            "in": "query",
            "description": "开始日期筛选（从）",
            "schema": { "type": "string", "format": "date" }
          },
          {
            "name": "start_date_to",
            "in": "query",
            "description": "开始日期筛选（至）",
            "schema": { "type": "string", "format": "date" }
          },
          {
            "name": "end_date_from",
            "in": "query",
            "description": "结束日期筛选（从）",
            "schema": { "type": "string", "format": "date" }
          },
          {
            "name": "end_date_to",
            "in": "query",
            "description": "结束日期筛选（至）",
            "schema": { "type": "string", "format": "date" }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取产品进度列表",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ProductProgressListResponse" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    },
    "/products/cancel": {
      "post": {
        "tags": ["Products"],
        "summary": "取消产品合约",
        "description": "根据复合键取消指定产品的合约",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ProductCompositeKey" }
            }
          }
        },
        "responses": {
          "200": { "description": "取消成功" },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    },
    "/products/fetch-keepa-data": {
      "post": {
        "tags": ["Products"],
        "summary": "获取 Keepa 产品数据",
        "description": "通过 Keepa API 获取产品的类目和销售排名信息。\n\n## 使用场景\n- 用户在新增产品时点击\"Fetch Keepa Data\"按钮\n- 根据输入的 ASIN 和 Start Date 调用 Keepa API 获取产品数据\n- 返回产品类目及其对应的 Sales Rank\n\n## Baseline Sales Rank 定义\n对于所有计划，Baseline BSR 定义为：**Start Date 前 5 天内**的最高（最差）BSR 数据点。\n\n## 业务流程\n1. 前端传入 ASIN 和 RAAS Start Date（必填）\n2. 后端根据 Start Date 计算 Baseline BSR（取前5天内的最高BSR）\n3. 调用 Keepa API 获取产品信息\n4. 从 Keepa 响应中解析出 product category 及 sales rank\n5. 返回类目列表供用户选择（sales_rank 为 null 的类目不会返回）\n6. 用户选择类目后，自动填入对应的 baseline sales rank\n\n## 超时设置\n该接口使用 15 秒超时时间，以适应 Keepa API 较长的响应时间。",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/KeepaFetchRequest" },
              "example": {
                "asin": "B08XN5WRZW",
                "raas_start_date": "2026-02-20"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "获取成功",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/KeepaFetchResponse" },
                "example": {
                  "success": true,
                  "asin": "B08XN5WRZW",
                  "categories": [
                    { "category_id": 123456, "category_name": "Electronics > Computers & Accessories", "sales_rank": 1234, "keepa_time": "2026-02-25T10:30:00Z" },
                    { "category_id": 234567, "category_name": "Electronics > Computer Accessories", "sales_rank": 567, "keepa_time": "2026-02-25T10:30:00Z" }
                  ],
                  "message": "Successfully fetched Keepa data"
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "500": { "$ref": "#/components/responses/InternalServerError" },
          "504": {
            "description": "请求超时",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "detail": { "type": "string", "example": "请求超时，Keepa API 响应时间过长，请稍后重试" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/progress/last-update-time": {
      "get": {
        "tags": ["Data Update"],
        "summary": "获取数据最后更新时间",
        "description": "获取数据表中的最后更新时间。\n\n## 使用场景\n- 前端页面加载时显示数据的最新更新时间\n- 用户在点击\"更新数据\"按钮前查看数据是否需要刷新\n\n## 返回值说明\n- 如果表中有数据：返回 last_updated_at 列的最大值\n- 如果表中无数据：返回 null",
        "responses": {
          "200": {
            "description": "获取成功",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/LastUpdateTimeResponse" },
                "example": {
                  "last_updated_at": "2026-02-25T10:00:00Z"
                }
              }
            }
          },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    },
    "/progress/update": {
      "post": {
        "tags": ["Data Update"],
        "summary": "触发数据更新任务",
        "description": "手动触发 Lakehouse 中的数据更新任务，将最新的进度数据同步到上层表。\n\n## 使用场景\n- 用户点击前端的\"更新数据\"按钮时调用\n- 触发后端定时任务重新从 Lakehouse 拉取数据\n\n## 注意事项\n- 这是一个异步操作，任务会在后台运行\n- 响应表示任务是否成功触发，而非是否完成\n- 触发后建议延迟一段时间再查询最新数据",
        "requestBody": {
          "required": false,
          "description": "此接口不需要请求体",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {}
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "任务触发成功",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/DataUpdateResponse" },
                "examples": {
                  "success": {
                    "summary": "成功触发",
                    "value": {
                      "success": true,
                      "message": "Data update task triggered successfully",
                      "updated_at": "2026-02-25T10:30:00Z"
                    }
                  },
                  "failure": {
                    "summary": "触发失败",
                    "value": {
                      "success": false,
                      "message": "Failed to trigger data update task"
                    }
                  }
                }
              }
            }
          },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    },
    "/hanna-orgs": {
      "get": {
        "tags": ["Products"],
        "summary": "获取 Hanna Org 列表",
        "description": "获取所有可用的 Hanna Org 列表，用于新增产品时的级联选择。\n\n## 使用场景\n- 新增产品 modal 中，用户首先选择 Hanna Org\n- 选择后自动过滤 Amazon Profile 下拉框",
        "responses": {
          "200": {
            "description": "获取成功",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HannaOrgListResponse" },
                "example": {
                  "items": [
                    { "hanna_org_name": "Hanna Org A" },
                    { "hanna_org_name": "Hanna Org B" }
                  ],
                  "total": 2
                }
              }
            }
          },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    },
    "/amazon-profiles": {
      "get": {
        "tags": ["Products"],
        "summary": "获取 Amazon Profile 列表",
        "description": "获取 Amazon Profile 列表，支持按 Hanna Org 筛选。\n\n## 使用场景\n- 新增产品 modal 中，根据已选择的 Hanna Org 过滤显示对应的 Amazon Profile\n- 如果未指定 hanna_org_name 参数，则返回所有 Amazon Profile\n\n## 级联逻辑\n- 用户选择 Hanna Org 后，前端传入 hanna_org_name 参数获取该组织下的 Amazon Profile\n- 用户选择 Amazon Profile 后，前端自动填充对应的 Hanna Org（如果尚未选择）",
        "parameters": [
          {
            "name": "hanna_org_name",
            "in": "query",
            "description": "按 Hanna Org 名称筛选（可选）",
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "获取成功",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/AmazonProfileListResponse" },
                "example": {
                  "items": [
                    { "amazon_profile_name": "Profile A1", "hanna_org_name": "Hanna Org A" },
                    { "amazon_profile_name": "Profile A2", "hanna_org_name": "Hanna Org A" }
                  ],
                  "total": 2
                }
              }
            }
          },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    }
  },
  "components": {
    "parameters": {
      "PageParam": {
        "name": "page",
        "in": "query",
        "description": "页码（从 1 开始）",
        "schema": {
          "type": "integer",
          "default": 1,
          "minimum": 1
        }
      },
      "PageSizeParam": {
        "name": "page_size",
        "in": "query",
        "description": "每页数量",
        "schema": {
          "type": "integer",
          "default": 20,
          "minimum": 1,
          "maximum": 100
        }
      }
    },
    "schemas": {
      "Product": {
        "type": "object",
        "required": [
          "amazon_profile_name",
          "hanna_org_name",
          "asin",
          "category_name",
          "raas_plan",
          "start_date",
          "end_date"
        ],
        "properties": {
          "amazon_profile_name": {
            "type": "string",
            "description": "Amazon Profile 名称"
          },
          "hanna_org_name": {
            "type": "string",
            "description": "Hanna Org 名称"
          },
          "asin": {
            "type": "string",
            "description": "ASIN"
          },
          "category_name": {
            "type": "string",
            "description": "类目名称"
          },
          "raas_plan": {
            "type": "string",
            "description": "RAAS 计划"
          },
          "start_date": {
            "type": "string",
            "format": "date",
            "description": "开始日期 (YYYY-MM-DD)"
          },
          "end_date": {
            "type": "string",
            "format": "date",
            "description": "结束日期 (YYYY-MM-DD)"
          },
          "baseline_sales_rank": {
            "type": "integer",
            "nullable": true,
            "description": "基线销售排名"
          },
          "target_acos": {
            "type": "number",
            "nullable": true,
            "description": "目标 ACOS（百分比）"
          },
          "target_ad_spend": {
            "type": "number",
            "nullable": true,
            "description": "目标广告花费"
          },
          "status": {
            "type": "string",
            "enum": ["ONGOING", "SUCCESS", "CANCELLED"],
            "description": "状态"
          },
          "marketplace": {
            "type": "string",
            "default": "US",
            "description": "市场"
          }
        }
      },
      "ProductCreate": {
        "type": "object",
        "required": [
          "amazon_profile_name",
          "hanna_org_name",
          "asin",
          "category_name",
          "raas_plan",
          "start_date",
          "end_date",
          "marketplace"
        ],
        "properties": {
          "amazon_profile_name": { "type": "string" },
          "hanna_org_name": { "type": "string" },
          "asin": { "type": "string" },
          "category_name": { "type": "string" },
          "raas_plan": { "type": "string" },
          "start_date": { "type": "string", "format": "date" },
          "end_date": { "type": "string", "format": "date" },
          "baseline_sales_rank": {
            "type": "integer",
            "nullable": true
          },
          "marketplace": {
            "type": "string",
            "default": "US"
          }
        }
      },
      "ProductUpdate": {
        "type": "object",
        "required": [
          "amazon_profile_name",
          "hanna_org_name",
          "asin",
          "category_name",
          "raas_plan",
          "start_date",
          "end_date",
          "status",
          "marketplace"
        ],
        "properties": {
          "amazon_profile_name": { "type": "string" },
          "hanna_org_name": { "type": "string" },
          "asin": { "type": "string" },
          "category_name": { "type": "string" },
          "raas_plan": { "type": "string" },
          "start_date": { "type": "string", "format": "date" },
          "end_date": { "type": "string", "format": "date" },
          "baseline_sales_rank": {
            "type": "integer",
            "nullable": true
          },
          "status": {
            "type": "string",
            "enum": ["ONGOING", "SUCCESS", "CANCELLED"]
          },
          "marketplace": { "type": "string" }
        }
      },
      "ProductCompositeKey": {
        "type": "object",
        "required": [
          "amazon_profile_name",
          "hanna_org_name",
          "asin",
          "category_name",
          "raas_plan",
          "start_date"
        ],
        "properties": {
          "amazon_profile_name": { "type": "string" },
          "hanna_org_name": { "type": "string" },
          "asin": { "type": "string" },
          "category_name": { "type": "string" },
          "raas_plan": { "type": "string" },
          "start_date": { "type": "string", "format": "date" },
          "marketplace": { "type": "string" }
        }
      },
      "ProductListResponse": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Product" }
          },
          "total": {
            "type": "integer",
            "description": "总记录数"
          },
          "page": {
            "type": "integer",
            "description": "当前页码"
          },
          "page_size": {
            "type": "integer",
            "description": "每页数量"
          },
          "total_pages": {
            "type": "integer",
            "description": "总页数"
          }
        }
      },
      "ProductProgress": {
        "type": "object",
        "description": "合并后的产品进度类型（包含产品基础信息和进度数据）",
        "properties": {
          "amazon_profile_name": {
            "type": "string",
            "description": "Amazon Profile 名称"
          },
          "hanna_org_name": {
            "type": "string",
            "description": "Hanna Org 名称"
          },
          "asin": {
            "type": "string",
            "description": "ASIN"
          },
          "category_name": {
            "type": "string",
            "description": "类目名称"
          },
          "raas_plan": {
            "type": "string",
            "description": "RAAS 计划"
          },
          "start_date": {
            "type": "string",
            "format": "date",
            "description": "开始日期 (YYYY-MM-DD)"
          },
          "end_date": {
            "type": "string",
            "format": "date",
            "description": "结束日期 (YYYY-MM-DD)"
          },
          "baseline_sales_rank": {
            "type": "integer",
            "nullable": true,
            "description": "基线销售排名"
          },
          "target_acos": {
            "type": "number",
            "nullable": true,
            "description": "目标 ACOS（百分比）"
          },
          "target_ad_spend": {
            "type": "number",
            "nullable": true,
            "description": "目标广告花费"
          },
          "status": {
            "type": "string",
            "enum": ["ONGOING", "SUCCESS", "CANCELLED"],
            "description": "状态"
          },
          "marketplace": {
            "type": "string",
            "default": "US",
            "description": "市场"
          },
          "img_url": {
            "type": "string",
            "nullable": true,
            "description": "产品图片 URL"
          },
          "days_remaining": {
            "type": "integer",
            "nullable": true,
            "description": "剩余天数"
          },
          "current_sales_rank": {
            "type": "integer",
            "nullable": true,
            "description": "当前排名"
          },
          "climb_days_met": {
            "type": "integer",
            "nullable": true,
            "description": "Climb 达标天数"
          },
          "days_taken": {
            "type": "integer",
            "nullable": true,
            "description": "已用天数"
          },
          "final_status_datechived": {
            "type": "string",
            "nullable": true,
            "format": "date-time",
            "description": "达成日期"
          },
          "cyber_minigun_actions": {
            "type": "integer",
            "nullable": true,
            "description": "赛博加特林动作数"
          },
          "cyber_minigun_launch_groups": {
            "type": "integer",
            "nullable": true,
            "description": "赛博加特林启动组数"
          },
          "campaigns_created_by_cyber_minigun": {
            "type": "integer",
            "nullable": true,
            "description": "赛博加特林创建的广告系列数"
          },
          "adgroups_created_by_cyber_minigun": {
            "type": "integer",
            "nullable": true,
            "description": "赛博加特林创建的广告组数"
          },
          "smart_campaigns": {
            "type": "integer",
            "nullable": true,
            "description": "智能广告活动数"
          },
          "campaigns_created_by_smart_campaigns": {
            "type": "integer",
            "nullable": true,
            "description": "智能广告创建的广告系列数"
          },
          "adgroups_created_by_smart_campaigns": {
            "type": "integer",
            "nullable": true,
            "description": "智能广告创建的广告组数"
          },
          "ad_spend_7d": {
            "type": "number",
            "nullable": true,
            "description": "7天广告花费"
          },
          "ad_sales_7d": {
            "type": "number",
            "nullable": true,
            "description": "7天广告销售"
          },
          "ad_orders_7d": {
            "type": "integer",
            "nullable": true,
            "description": "7天广告订单数"
          },
          "acos_7d": {
            "type": "number",
            "nullable": true,
            "description": "7天 ACOS 值"
          },
          "ad_spend_14d": {
            "type": "number",
            "nullable": true,
            "description": "14天广告花费"
          },
          "ad_sales_14d": {
            "type": "number",
            "nullable": true,
            "description": "14天广告销售"
          },
          "ad_orders_14d": {
            "type": "integer",
            "nullable": true,
            "description": "14天广告订单数"
          },
          "acos_14d": {
            "type": "number",
            "nullable": true,
            "description": "14天 ACOS 值"
          },
          "ad_spend_30d": {
            "type": "number",
            "nullable": true,
            "description": "30天广告花费"
          },
          "ad_sales_30d": {
            "type": "number",
            "nullable": true,
            "description": "30天广告销售"
          },
          "ad_orders_30d": {
            "type": "integer",
            "nullable": true,
            "description": "30天广告订单数"
          },
          "acos_30d": {
            "type": "number",
            "nullable": true,
            "description": "30天 ACOS 值"
          },
          "ad_spend_rt": {
            "type": "number",
            "nullable": true,
            "description": "当天至今广告花费"
          },
          "ad_sales_rt": {
            "type": "number",
            "nullable": true,
            "description": "当天至今广告销售"
          },
          "ad_orders_rt": {
            "type": "integer",
            "nullable": true,
            "description": "当天至今广告订单数"
          },
          "acos_rt": {
            "type": "number",
            "nullable": true,
            "description": "当天至今 ACOS 值"
          }
        }
      },
      "ProductProgressListResponse": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/ProductProgress" }
          },
          "total": {
            "type": "integer",
            "description": "总记录数"
          },
          "page": {
            "type": "integer",
            "description": "当前页码"
          },
          "page_size": {
            "type": "integer",
            "description": "每页数量"
          },
          "total_pages": {
            "type": "integer",
            "description": "总页数"
          }
        }
      },
      "KeepaFetchRequest": {
        "type": "object",
        "required": ["asin"],
        "properties": {
          "asin": {
            "type": "string",
            "description": "ASIN"
          },
          "raas_start_date": {
            "type": "string",
            "format": "date",
            "description": "RAAS 计划开始日期 (YYYY-MM-DD)，用于计算 baseline sales rank（定义为开始日期前5天内的最高BSR）"
          }
        }
      },
      "KeepaCategory": {
        "type": "object",
        "description": "Keepa 产品类目",
        "properties": {
          "category_id": {
            "type": "integer",
            "description": "Keepa 类目 ID"
          },
          "category_name": {
            "type": "string",
            "description": "类目名称"
          },
          "sales_rank": {
            "type": "integer",
            "nullable": true,
            "description": "该类目下的销售排名"
          },
          "keepa_time": {
            "type": "string",
            "description": "Keepa 获取到该排名的日期时间"
          }
        }
      },
      "KeepaFetchResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "是否成功获取数据"
          },
          "asin": {
            "type": "string",
            "description": "ASIN"
          },
          "categories": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/KeepaCategory" },
            "description": "产品类目列表及其销售排名"
          },
          "message": {
            "type": "string",
            "description": "响应消息"
          }
        }
      },
      "LastUpdateTimeResponse": {
        "type": "object",
        "properties": {
          "last_updated_at": {
            "type": "string",
            "nullable": true,
            "format": "date-time",
            "description": "数据最后更新时间 (ISO 8601 格式)"
          }
        }
      },
      "DataUpdateResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "任务是否成功触发"
          },
          "message": {
            "type": "string",
            "description": "响应消息"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "任务触发时间（可选）"
          }
        }
      },
      "HannaOrg": {
        "type": "object",
        "properties": {
          "hanna_org_name": {
            "type": "string",
            "description": "Hanna Org 名称"
          }
        }
      },
      "HannaOrgListResponse": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/HannaOrg" },
            "description": "Hanna Org 列表"
          },
          "total": {
            "type": "integer",
            "description": "总数量"
          }
        }
      },
      "AmazonProfile": {
        "type": "object",
        "properties": {
          "amazon_profile_name": {
            "type": "string",
            "description": "Amazon Profile 名称"
          },
          "hanna_org_name": {
            "type": "string",
            "description": "关联的 Hanna Org 名称"
          }
        }
      },
      "AmazonProfileListResponse": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/AmazonProfile" },
            "description": "Amazon Profile 列表"
          },
          "total": {
            "type": "integer",
            "description": "总数量"
          }
        }
      }
    },
    "responses": {
      "BadRequest": {
        "description": "请求参数错误",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "detail": { "type": "string" }
              }
            }
          }
        }
      },
      "Unauthorized": {
        "description": "未授权",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "detail": { "type": "string" }
              }
            }
          }
        }
      },
      "InternalServerError": {
        "description": "服务器内部错误",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "detail": { "type": "string" }
              }
            }
          }
        }
      }
    }
  }
}
